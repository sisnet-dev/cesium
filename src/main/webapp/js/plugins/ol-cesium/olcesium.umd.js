!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("ol/geom/Point.js"),require("ol/proj.js"),require("ol/easing.js"),require("ol/layer/Tile.js"),require("ol/layer/Image.js"),require("ol/source/ImageStatic.js"),require("ol/source/ImageWMS.js"),require("ol/source/TileImage.js"),require("ol/source/TileWMS.js"),require("ol/source/VectorTile.js"),require("ol/source/Image.js"),require("ol/source.js"),require("ol/format/MVT.js"),require("ol/style/Style.js"),require("ol/style/Stroke.js"),require("ol/render.js"),require("ol/util.js"),require("ol/structs/LRUCache.js"),require("ol/tilegrid.js"),require("ol/tileurlfunction.js"),require("ol/layer/VectorTile.js"),require("ol/extent"),require("ol/Observable.js"),require("ol/layer/Group.js"),require("ol/source/Vector.js"),require("ol/layer/Layer.js"),require("ol/source/Cluster.js"),require("ol/layer/Vector.js"),require("ol/geom/Geometry.js"),require("ol/style/Icon.js"),require("ol/geom/Polygon.js"),require("ol/extent.js"),require("ol/geom/SimpleGeometry.js"),require("ol/Overlay.js")):"function"==typeof define&&define.amd?define(["ol/geom/Point.js","ol/proj.js","ol/easing.js","ol/layer/Tile.js","ol/layer/Image.js","ol/source/ImageStatic.js","ol/source/ImageWMS.js","ol/source/TileImage.js","ol/source/TileWMS.js","ol/source/VectorTile.js","ol/source/Image.js","ol/source.js","ol/format/MVT.js","ol/style/Style.js","ol/style/Stroke.js","ol/render.js","ol/util.js","ol/structs/LRUCache.js","ol/tilegrid.js","ol/tileurlfunction.js","ol/layer/VectorTile.js","ol/extent","ol/Observable.js","ol/layer/Group.js","ol/source/Vector.js","ol/layer/Layer.js","ol/source/Cluster.js","ol/layer/Vector.js","ol/geom/Geometry.js","ol/style/Icon.js","ol/geom/Polygon.js","ol/extent.js","ol/geom/SimpleGeometry.js","ol/Overlay.js"],t):"object"==typeof exports?exports.olcs=t(require("ol/geom/Point.js"),require("ol/proj.js"),require("ol/easing.js"),require("ol/layer/Tile.js"),require("ol/layer/Image.js"),require("ol/source/ImageStatic.js"),require("ol/source/ImageWMS.js"),require("ol/source/TileImage.js"),require("ol/source/TileWMS.js"),require("ol/source/VectorTile.js"),require("ol/source/Image.js"),require("ol/source.js"),require("ol/format/MVT.js"),require("ol/style/Style.js"),require("ol/style/Stroke.js"),require("ol/render.js"),require("ol/util.js"),require("ol/structs/LRUCache.js"),require("ol/tilegrid.js"),require("ol/tileurlfunction.js"),require("ol/layer/VectorTile.js"),require("ol/extent"),require("ol/Observable.js"),require("ol/layer/Group.js"),require("ol/source/Vector.js"),require("ol/layer/Layer.js"),require("ol/source/Cluster.js"),require("ol/layer/Vector.js"),require("ol/geom/Geometry.js"),require("ol/style/Icon.js"),require("ol/geom/Polygon.js"),require("ol/extent.js"),require("ol/geom/SimpleGeometry.js"),require("ol/Overlay.js")):e.olcs=t(e["ol/geom/Point.js"],e["ol/proj.js"],e["ol/easing.js"],e["ol/layer/Tile.js"],e["ol/layer/Image.js"],e["ol/source/ImageStatic.js"],e["ol/source/ImageWMS.js"],e["ol/source/TileImage.js"],e["ol/source/TileWMS.js"],e["ol/source/VectorTile.js"],e["ol/source/Image.js"],e["ol/source.js"],e["ol/format/MVT.js"],e["ol/style/Style.js"],e["ol/style/Stroke.js"],e["ol/render.js"],e["ol/util.js"],e["ol/structs/LRUCache.js"],e["ol/tilegrid.js"],e["ol/tileurlfunction.js"],e["ol/layer/VectorTile.js"],e["ol/extent"],e["ol/Observable.js"],e["ol/layer/Group.js"],e["ol/source/Vector.js"],e["ol/layer/Layer.js"],e["ol/source/Cluster.js"],e["ol/layer/Vector.js"],e["ol/geom/Geometry.js"],e["ol/style/Icon.js"],e["ol/geom/Polygon.js"],e["ol/extent.js"],e["ol/geom/SimpleGeometry.js"],e["ol/Overlay.js"])}(self,(function(e,t,i,r,n,o,s,a,l,u,c,h,m,d,g,f,p,v,y,C,_,S,b,w,T,P,L,R,j,E,x,O,A,I){return(()=>{"use strict";var G={481:e=>{e.exports=b},932:e=>{e.exports=I},833:e=>{e.exports=i},761:e=>{e.exports=S},740:e=>{e.exports=O},808:e=>{e.exports=m},477:e=>{e.exports=j},321:t=>{t.exports=e},196:e=>{e.exports=x},708:e=>{e.exports=A},602:e=>{e.exports=w},494:e=>{e.exports=n},455:e=>{e.exports=P},841:e=>{e.exports=r},134:e=>{e.exports=R},99:e=>{e.exports=_},894:e=>{e.exports=t},949:e=>{e.exports=f},272:e=>{e.exports=h},347:e=>{e.exports=L},239:e=>{e.exports=c},260:e=>{e.exports=o},925:e=>{e.exports=s},730:e=>{e.exports=a},207:e=>{e.exports=l},42:e=>{e.exports=T},800:e=>{e.exports=u},65:e=>{e.exports=v},741:e=>{e.exports=E},862:e=>{e.exports=g},40:e=>{e.exports=d},720:e=>{e.exports=y},737:e=>{e.exports=C},306:e=>{e.exports=p}},F={};function M(e){var t=F[e];if(void 0!==t)return t.exports;var i=F[e]={exports:{}};return G[e](i,i.exports,M),i.exports}M.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return M.d(t,{a:t}),t},M.d=(e,t)=>{for(var i in t)M.o(t,i)&&!M.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},M.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),M.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var V={};return(()=>{M.r(V),M.d(V,{default:()=>De});M(321);var e=M(894),t={};function i(e,t,i){return e.on(t,i)}t.obj=function(e){return e},t.supportsImageRenderingPixelatedResult_=void 0,t.imageRenderingValueResult_=void 0,t.supportsImageRenderingPixelated=function(){if(void 0===t.supportsImageRenderingPixelatedResult_){var e=document.createElement("canvas");e.setAttribute("style","image-rendering: -moz-crisp-edges; image-rendering: pixelated;");var i=e.style.imageRendering;t.supportsImageRenderingPixelatedResult_=!!i,t.supportsImageRenderingPixelatedResult_&&(t.imageRenderingValueResult_=i)}return t.supportsImageRenderingPixelatedResult_},t.imageRenderingValue=function(){return t.supportsImageRenderingPixelated(),t.imageRenderingValueResult_||""},t.getSourceProjection=function(e){return e.get("olcs.projection")||e.getProjection()};var r=0;function n(e){return e.olcs_uid||(e.olcs_uid=++r)}function o(e){var t=Cesium.GroundPolylinePrimitive;return t&&t.isSupported(e)}const s=t;var a,l=M(833),u=M(841),c=M.n(u),h=M(494),m=M.n(h),d=M(260),g=M.n(d),f=M(925),p=M.n(f),v=M(730),y=M.n(v),C=M(207),_=M.n(C),S=M(800),b=M.n(S),w=M(239),T=M(272),P=(a=new T.Tile({projection:"EPSG:3857",wrapX:!0}).getTileCoordForTileUrlFunction([6,-31,22]))&&33===a[1]&&22===a[2],L=function(){function t(e,t,i){var r=this;this.source_=t,this.projection_=null,this.fallbackProj_=i||null,this.ready_=!1,this.tilingScheme_=null,this.rectangle_=null,this.map_=e,this.shouldRequestNextLevel=!1;var n=this.source_.get("olcs.proxy");n&&("function"==typeof n?this.proxy_={getURL:n}:"string"==typeof n&&(this.proxy_=new Cesium.DefaultProxy(n))),this.errorEvent_=new Cesium.Event,this.emptyCanvas_=document.createElement("canvas"),this.emptyCanvas_.width=1,this.emptyCanvas_.height=1,this.source_.on("change",(function(e){r.handleSourceChanged_()})),this.handleSourceChanged_()}var i=t.prototype;return i.handleSourceChanged_=function(t){if(!this.ready_&&"ready"==this.source_.getState()){this.projection_=s.getSourceProjection(this.source_)||this.fallbackProj_;var i={numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1};if(null!==this.source_.tileGrid&&this.source_.tileGrid.forEachTileCoord(this.projection_.getExtent(),0,(function(e){e[0];var t=e[1],r=e[2];i.numberOfLevelZeroTilesX=t+1,i.numberOfLevelZeroTilesY=r+1})),this.projection_==(0,e.get)("EPSG:4326"))this.shouldRequestNextLevel=1===i.numberOfLevelZeroTilesX&&1===i.numberOfLevelZeroTilesY,this.tilingScheme_=new Cesium.GeographicTilingScheme(i);else{if(this.projection_!=(0,e.get)("EPSG:3857"))return;this.shouldRequestNextLevel=!1,this.tilingScheme_=new Cesium.WebMercatorTilingScheme(i)}this.rectangle_=this.tilingScheme_.rectangle,this.ready_=!0}},i.getTileCredits=function(e,t,i){var r=this.source_.getAttributions();if(!r)return[];var n=this.map_.getView().calculateExtent(this.map_.getSize()),o=this.map_.getView().getCenter();return Y(r,this.shouldRequestNextLevel?i+1:i,o,n)},i.requestImage=function(e,t,i){var r=this.source_.getTileUrlFunction();if(r&&this.projection_){var n=this.shouldRequestNextLevel?i+1:i,o=t;P||(o=-t-1);var s=r.call(this.source_,[n,e,o],1,this.projection_);return this.proxy_&&(s=this.proxy_.getURL(s)),s?Cesium.ImageryProvider.loadImage(this,s):this.emptyCanvas_}return this.emptyCanvas_},t}();Object.defineProperties(L.prototype,{ready:{get:function(){return this.ready_}},rectangle:{get:function(){return this.rectangle_}},tileWidth:{get:function(){var e=this.source_.getTileGrid();return e?Array.isArray(e.getTileSize(0))?e.getTileSize(0)[0]:e.getTileSize(0):256}},tileHeight:{get:function(){var e=this.source_.getTileGrid();return e?Array.isArray(e.getTileSize(0))?e.getTileSize(0)[1]:e.getTileSize(0):256}},maximumLevel:{get:function(){var e=this.source_.getTileGrid();return e?e.getMaxZoom():18}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this.tilingScheme_}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this.errorEvent_}},proxy:{get:function(){return this.proxy_}},hasAlphaChannel:{get:function(){return!0}},pickFeatures:{get:function(){}}});const R=L;var j=M(808),E=M.n(j),x=M(40),O=M.n(x),A=M(862),I=M.n(A),G=M(949),F=M(306),k=M(65),q=M.n(k),N=M(720),D=M(737),B=new(E()),W=[new(O())({stroke:new(I())({color:"blue",width:2})})],U=function(){function t(t){this.urls=t.urls,this.ready=!0,this.readyPromise=Promise.resolve(!0),this.tileWidth=256,this.tileHeight=256,this.maximumLevel=t.maximumLevel||20,this.minimumLevel=t.minimumLevel||0,this.tilingScheme=new Cesium.WebMercatorTilingScheme,this.rectangle=t.rectangle||this.tilingScheme.rectangle,this.errorEvent=new Cesium.Event,this.credit=t.credit,this.hasAlphaChannel=!0,this.styleFunction_=t.styleFunction||function(){return W},this.projection_=(0,e.get)("EPSG:3857"),this.emptyCanvas_=document.createElement("canvas"),this.emptyCanvas_.width=1,this.emptyCanvas_.height=1,this.tileRectangle_=new Cesium.Rectangle;var i=void 0!==t.cacheSize?t.cacheSize:50;this.tileCache=new(q())(i),this.featureCache=t.featureCache||new(q())(i);var r=(0,N.getForProjection)(this.projection_);this.tileFunction_=(0,D.createFromTemplates)(this.urls,r)}var i=t.prototype;return i.getTileCredits=function(){return[]},i.pickFeatures=function(){},i.getTileFeatures=function(e,t,i){var r,n=this,o=this.getCacheKey_(e,t,i);if(this.featureCache.containsKey(o)&&(r=this.featureCache.get(o)),!r){var s=this.getUrl_(e,t,i);if(r=fetch(s).then((function(e){return e.ok?e:Promise.reject(e)})).then((function(e){return e.arrayBuffer()})).then((function(e){return n.readFeaturesFromBuffer(e)})),this.featureCache.set(o,r),this.featureCache.getCount()>2*this.featureCache.highWaterMark)for(;this.featureCache.canExpireCache();)this.featureCache.pop()}return r},i.readFeaturesFromBuffer=function(e){var t,i=this;F.VERSION<="6.4.4"&&(t={extent:[0,0,4096,4096],dataProjection:B.dataProjection,featureProjection:B.dataProjection});var r=B.readFeatures(e,t),n=this.tileWidth/4096;return r.forEach((function(e){for(var t=e.getFlatCoordinates(),r=!1,o=0;o<t.length;++o)t[o]*=n,r&&(t[o]=i.tileWidth-t[o]),F.VERSION<="6.4.4"&&(r=!r)})),r},i.getUrl_=function(e,t,i){return this.tileFunction_([e,t,i])},i.getCacheKey_=function(e,t,i){return e+"_"+t+"_"+i},i.requestImage=function(e,t,i,r){var n=this;if(i<this.minimumLevel)return this.emptyCanvas_;try{var o,s=this.getCacheKey_(i,e,t);if(this.tileCache.containsKey(s)&&(o=this.tileCache.get(s)),!o&&(o=this.getTileFeatures(i,e,t).then((function(r){n.tilingScheme.tileXYToNativeRectangle(e,t,i,n.tileRectangle_);var o=(n.tileRectangle_.east-n.tileRectangle_.west)/n.tileWidth;return n.rasterizeFeatures(r,n.styleFunction_,o)})),this.tileCache.set(s,o),this.tileCache.getCount()>2*this.tileCache.highWaterMark))for(;this.tileCache.canExpireCache();)this.tileCache.pop();return o}catch(e){this.raiseEvent("could not render pbf to tile",e)}},i.rasterizeFeatures=function(e,t,i){var r=document.createElement("canvas"),n=(0,G.toContext)(r.getContext("2d"),{size:[this.tileWidth,this.tileHeight]});return e.forEach((function(e){var r=t(e,i);r&&r.forEach((function(t){n.setStyle(t),n.drawGeometry(e)}))})),r},t}(),z=M(99),H=M.n(z),K=M(761),Z={};function Y(e,t,i,r){if(!e)return[];var n=e({viewState:{zoom:t,center:i},extent:r});return Array.isArray(n)||(n=[n]),n.map((function(e){return new Cesium.Credit(e,!0)}))}Z.computePixelSizeAtCoordinate=function(e,t){var i=e.camera,r=e.canvas,n=i.frustum,o=Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(i.position,t,new Cesium.Cartesian3));return n.getPixelDimensions(r.clientWidth,r.clientHeight,o,e.pixelRatio,new Cesium.Cartesian2)},Z.computeBoundingBoxAtTarget=function(e,t,i){var r=Z.computePixelSizeAtCoordinate(e,t),n=Cesium.Transforms.eastNorthUpToFixedFrame(t),o=Cesium.Matrix4.multiplyByPoint(n,new Cesium.Cartesian3(-r.x*i,-r.y*i,0),new Cesium.Cartesian3),s=Cesium.Matrix4.multiplyByPoint(n,new Cesium.Cartesian3(r.x*i,r.y*i,0),new Cesium.Cartesian3);return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray([o,s])},Z.applyHeightOffsetToGeometry=function(e,t){e.applyTransform((function(e,i,r){if(void 0!==r&&r>=3)for(var n=0;n<i.length;n+=r)i[n+2]=i[n+2]+t;return i}))},Z.createMatrixAtCoordinates=function(e,t,i,r){void 0===t&&(t=0),void 0===i&&(i=Cesium.Cartesian3.ZERO),void 0===r&&(r=new Cesium.Cartesian3(1,1,1));var n=Z.ol4326CoordinateToCesiumCartesian(e),o=Cesium.Transforms.eastNorthUpToFixedFrame(n),s=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z,-t),a=Cesium.Matrix4.fromTranslationQuaternionRotationScale(i,s,r);return Cesium.Matrix4.multiply(o,a,new Cesium.Matrix4)},Z.rotateAroundAxis=function(e,t,i,r,n){var o=Cesium.Math.clamp,s=Cesium.defaultValue,a=n||{},u=s(a.duration,500),c=s(a.easing,l.linear),h=a.callback,m=0,d=new Cesium.Matrix4,g=Date.now();window.requestAnimationFrame((function n(){var s=Date.now(),a=c(o((s-g)/u,0,1));e.transform.clone(d);var l=(a-m)*t;m=a,e.lookAtTransform(r),e.rotate(i,l),e.lookAtTransform(d),a<1?window.requestAnimationFrame(n):h&&h()}))},Z.setHeadingUsingBottomCenter=function(e,t,i,r){var n=e.camera,o=Z.computeAngleToZenith(e,i),s=n.right,a=Cesium.Quaternion.fromAxisAngle(s,o),l=Cesium.Matrix3.fromQuaternion(a),u=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(n.position,i,u);var c=new Cesium.Cartesian3;Cesium.Matrix3.multiplyByVector(l,u,c),Cesium.Cartesian3.add(c,i,c);var h=Cesium.Matrix4.fromTranslation(c);(0,Z.rotateAroundAxis)(n,t,c,h,r)},Z.pickOnTerrainOrEllipsoid=function(e,t){var i=e.camera.getPickRay(t);return e.globe.pick(i,e)||e.camera.pickEllipsoid(t)},Z.pickBottomPoint=function(e){var t=e.canvas,i=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight);return Z.pickOnTerrainOrEllipsoid(e,i)},Z.pickCenterPoint=function(e){var t=e.canvas,i=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight/2);return Z.pickOnTerrainOrEllipsoid(e,i)},Z.computeSignedTiltAngleOnGlobe=function(e){var t=e.camera,i=new Cesium.Ray(t.position,t.direction),r=e.globe.pick(i,e);if(!r){var n=Cesium.Ellipsoid.WGS84,o=Cesium.IntersectionTests.rayEllipsoid(i,n);o&&(r=Cesium.Ray.getPoint(i,o.start))}if(r){var s=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(r,s);var a=(0,Z.signedAngleBetween)(t.direction,s,t.right)-Math.PI;return Cesium.Math.convertLongitudeRange(a)}},Z.bottomFovRay=function(e){var t=e.camera,i=t.frustum.fovy/2,r=t.direction,n=Cesium.Quaternion.fromAxisAngle(t.right,i),o=Cesium.Matrix3.fromQuaternion(n),s=new Cesium.Cartesian3;return Cesium.Matrix3.multiplyByVector(o,r,s),new Cesium.Ray(t.position,s)},Z.signedAngleBetween=function(e,t,i){var r=new Cesium.Cartesian3,n=new Cesium.Cartesian3,o=new Cesium.Cartesian3;Cesium.Cartesian3.normalize(e,r),Cesium.Cartesian3.normalize(t,n),Cesium.Cartesian3.cross(r,n,o);var s=Cesium.Cartesian3.dot(r,n),a=Cesium.Cartesian3.magnitude(o),l=Cesium.Cartesian3.dot(i,o),u=Math.atan2(a,s);return l>=0?u:-u},Z.computeAngleToZenith=function(e,t){var i=e.camera,r=i.frustum.fovy/2,n=Z.bottomFovRay(e),o=Cesium.Cartesian3.clone(n.direction);Cesium.Cartesian3.negate(o,o);var s=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(t,s);var a=new Cesium.Cartesian3;return Cesium.Cartesian3.negate(i.right,a),Z.signedAngleBetween(s,o,a)+r},Z.extentToRectangle=function(t,i){if(t&&i){var r=(0,e.transformExtent)(t,i,"EPSG:4326");return Cesium.Rectangle.fromDegrees(r[0],r[1],r[2],r[3])}return null},Z.sourceToImageryProvider=function(e,t,i,r){var n=t.get("olcs_skip");if(n)return null;var o=null;if(t instanceof p()&&t.getUrl()&&t.getImageLoadFunction()===w.defaultImageLoadFunction){var a={"olcs.proxy":t.get("olcs.proxy"),"olcs.extent":t.get("olcs.extent"),"olcs.projection":t.get("olcs.projection"),"olcs.imagesource":t};(t=new(_())({url:t.getUrl(),attributions:t.getAttributions(),projection:t.getProjection(),params:t.getParams()})).setProperties(a)}if(t instanceof y()){var l=s.getSourceProjection(t);if(l||(l=i),!Z.isCesiumProjection(l))return null;o=new R(e,t,i)}else{if(!(t instanceof g())){if(t instanceof b()){var u=s.getSourceProjection(t);if(u||(u=i),!1===n){var c,h=u.getCode().split(":")[1],m=t.urls.map((function(e){return e.replace(h,"3857")})),d=r.getExtent(),f=Z.extentToRectangle(d,u),v=t.get("olcs_minimumLevel"),C=t.getAttributions(),S=r.getStyleFunction();if(d&&C)c=Y(C,0,(0,K.getCenter)(d),d)[0];return o=new U({credit:c,rectangle:f,minimumLevel:v,styleFunction:S,urls:m})}return null}return null}var T=s.getSourceProjection(t);if(T||(T=i),!Z.isCesiumProjection(T))return null;o=new Cesium.SingleTileImageryProvider({url:t.getUrl(),rectangle:new Cesium.Rectangle.fromDegrees(t.getImageExtent()[0],t.getImageExtent()[1],t.getImageExtent()[2],t.getImageExtent()[3])})}return o},Z.tileLayerToImageryLayer=function(e,t,i){if(!(t instanceof c()||t instanceof m()||t instanceof H()))return null;var r=t.getSource();if(!r)return null;var n=r.get("olcs_provider");if(n||(n=this.sourceToImageryProvider(e,r,i,t)),!n)return null;var o={},s=t.get("olcs.extent")||t.getExtent();return s&&(o.rectangle=Z.extentToRectangle(s,i)),new Cesium.ImageryLayer(n,o)},Z.updateCesiumLayerProperties=function(e,t){var i=1,r=!0;[e.layer].concat(e.parents).forEach((function(e){var t=e.getOpacity();void 0!==t&&(i*=t);var n=e.getVisible();void 0!==n&&(r&=n)})),t.alpha=i,t.show=r},Z.ol4326CoordinateToCesiumCartesian=function(e){var t=e;return t.length>2?Cesium.Cartesian3.fromDegrees(t[0],t[1],t[2]):Cesium.Cartesian3.fromDegrees(t[0],t[1])},Z.ol4326CoordinateArrayToCsCartesians=function(e){for(var t=Z.ol4326CoordinateToCesiumCartesian,i=[],r=0;r<e.length;++r)i.push(t(e[r]));return i},Z.olGeometryCloneTo4326=function(t,i){var r=(0,e.get)("EPSG:4326"),n=(0,e.get)(i);if(n!==r){var o=t.getProperties();(t=t.clone()).transform(n,r),t.setProperties(o)}return t},Z.convertColorToCesium=function(e){if(e=e||"black",Array.isArray(e))return new Cesium.Color(Cesium.Color.byteToFloat(e[0]),Cesium.Color.byteToFloat(e[1]),Cesium.Color.byteToFloat(e[2]),e[3]);if("string"==typeof e)return Cesium.Color.fromCssColorString(e);if(e instanceof CanvasPattern||e instanceof CanvasGradient){var t=document.createElement("canvas"),i=t.getContext("2d");return t.width=t.height=256,i.fillStyle=e,i.fillRect(0,0,t.width,t.height),new Cesium.ImageMaterialProperty({image:t})}},Z.convertUrlToCesium=function(e){var t="",i=/\{(\d|[a-z])-(\d|[a-z])\}/,r=i.exec(e);if(r){e=e.replace(i,"{s}");var n,o=r[1].charCodeAt(0),s=r[2].charCodeAt(0);for(n=o;n<=s;++n)t+=String.fromCharCode(n)}return{url:e,subdomains:t}},Z.resetToNorthZenith=function(e,t){return new Promise((function(i,r){var n=t.camera,o=Z.pickBottomPoint(t);if(o){var s=e.getView().getRotation();if(void 0!==s){var a=Z.computeAngleToZenith(t,o);Z.setHeadingUsingBottomCenter(t,s,o);var l=Cesium.Matrix4.fromTranslation(o),u=n.right,c={callback:function(){var t=e.getView();Z.normalizeView(t),i()}};Z.rotateAroundAxis(n,-a,u,l,c)}else r("The view is not initialized")}else r("Could not get bottom pivot")}))},Z.rotateAroundBottomCenter=function(e,t){return new Promise((function(i,r){var n=e.camera,o=Z.pickBottomPoint(e);if(o){var s={callback:i},a=Cesium.Matrix4.fromTranslation(o),l=n.right;(0,Z.rotateAroundAxis)(n,-t,l,a,s)}else r("could not get bottom pivot")}))},Z.normalizeView=function(e,t){void 0===t&&(t=0);var i=e.getResolution();e.setRotation(t),e.constrainResolution?e.setResolution(e.constrainResolution(i)):e.setResolution(e.getConstrainedResolution(i))},Z.isCesiumProjection=function(t){var i=t===(0,e.get)("EPSG:3857"),r=t===(0,e.get)("EPSG:4326");return i||r};const Q=Z;function X(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return $(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return $(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}const J=function(){function e(e){this.ol3d=e,this.scene_=e.getCesiumScene(),this.canvas_=this.scene_.canvas,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.repaintEventNames_=["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"],this.enable()}var t=e.prototype;return t.enable=function(){this.scene_.requestRenderMode=!0,this.scene_.maximumRenderTimeChange=1e3;for(var e,t=X(this.repaintEventNames_);!(e=t()).done;){var i=e.value;this.canvas_.addEventListener(i,this._boundNotifyRepaintRequired,!1)}window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)},t.disable=function(){for(var e,t=X(this.repaintEventNames_);!(e=t()).done;){var i=e.value;this.canvas_.removeEventListener(i,this._boundNotifyRepaintRequired,!1)}window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired),this.scene_.requestRenderMode=!1},t.restartRenderLoop=function(){this.notifyRepaintRequired()},t.notifyRepaintRequired=function(){this.scene_.requestRender()},e}();var ee=M(481),te=M.n(ee);function ie(e){return 180*e/Math.PI}function re(e){return e*Math.PI/180}const ne=function(){function t(e,i){var r=this;this.scene_=e,this.cam_=e.camera,this.map_=i,this.view_=null,this.viewListenKey_=null,this.toLonLat_=t.identityProjection,this.fromLonLat_=t.identityProjection,this.tilt_=0,this.distance_=0,this.lastCameraViewMatrix_=null,this.viewUpdateInProgress_=!1,this.map_.on("change:view",(function(e){r.setView_(r.map_.getView())})),this.setView_(this.map_.getView())}t.identityProjection=function(e,t,i){var r=i||e.length;if(t)for(var n=0;n<r;++n)t[n]=e[n];return e};var i=t.prototype;return i.setView_=function(i){var r=this;if(this.view_&&((0,ee.unByKey)(this.viewListenKey_),this.viewListenKey_=null),this.view_=i,i){var n=(0,e.getTransform)(i.getProjection(),"EPSG:4326"),o=(0,e.getTransform)("EPSG:4326",i.getProjection());this.toLonLat_=n,this.fromLonLat_=o,this.viewListenKey_=i.on("propertychange",(function(e){return r.handleViewEvent_(e)})),this.readFromView()}else this.toLonLat_=t.identityProjection,this.fromLonLat_=t.identityProjection},i.handleViewEvent_=function(e){this.viewUpdateInProgress_||this.readFromView()},i.setHeading=function(e){this.view_&&this.view_.setRotation(e)},i.getHeading=function(){if(this.view_)return this.view_.getRotation()||0},i.setTilt=function(e){this.tilt_=e,this.updateCamera_()},i.getTilt=function(){return this.tilt_},i.setDistance=function(e){this.distance_=e,this.updateCamera_(),this.updateView()},i.getDistance=function(){return this.distance_},i.setCenter=function(e){this.view_&&this.view_.setCenter(e)},i.getCenter=function(){if(this.view_)return this.view_.getCenter()},i.setPosition=function(e){if(this.toLonLat_){var t=this.toLonLat_(e),i=new Cesium.Cartographic(re(t[0]),re(t[1]),this.getAltitude());this.cam_.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(i)}),this.updateView()}},i.getPosition=function(){if(this.fromLonLat_){var e=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);return this.fromLonLat_([ie(e.longitude),ie(e.latitude)])}},i.setAltitude=function(e){var t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);t.height=e,this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(t),this.updateView()},i.getAltitude=function(){return Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position).height},i.updateCamera_=function(){if(this.view_&&this.toLonLat_){var e=this.view_.getCenter();if(e){var t=this.toLonLat_(e),i=new Cesium.Cartographic(re(t[0]),re(t[1]));if(this.scene_.globe){var r=this.scene_.globe.getHeight(i);i.height=r||0}var n=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),o={pitch:this.tilt_-Cesium.Math.PI_OVER_TWO,heading:-this.view_.getRotation(),roll:void 0};this.cam_.setView({destination:n,orientation:o}),this.cam_.moveBackward(this.distance_),this.checkCameraChange(!0)}}},i.readFromView=function(){if(this.view_&&this.toLonLat_){var e=this.view_.getCenter();if(null!=e){var t=this.toLonLat_(e),i=this.view_.getResolution();this.distance_=this.calcDistanceForResolution(i||0,re(t[1])),this.updateCamera_()}}},i.updateView=function(){if(this.view_&&this.fromLonLat_){this.viewUpdateInProgress_=!0;var e=Cesium.Ellipsoid.WGS84,t=this.scene_,i=Q.pickCenterPoint(t),r=i;if(!r){var n=t.globe,o=this.cam_.positionCartographic.clone(),s=n.getHeight(o);o.height=s||0,r=Cesium.Ellipsoid.WGS84.cartographicToCartesian(o)}this.distance_=Cesium.Cartesian3.distance(r,this.cam_.position);var a=e.cartesianToCartographic(r);if(this.view_.setCenter(this.fromLonLat_([ie(a.longitude),ie(a.latitude)])),this.view_.setResolution(this.calcResolutionForDistance(this.distance_,a?a.latitude:0)),i){var l=this.cam_.position,u=new Cesium.Cartesian3;e.geocentricSurfaceNormal(i,u);var c=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(l,i,c),Cesium.Cartesian3.normalize(c,c);var h=this.cam_.up,m=this.cam_.right,d=new Cesium.Cartesian3(-i.y,i.x,0),g=Cesium.Cartesian3.angleBetween(m,d),f=Cesium.Cartesian3.cross(i,h,new Cesium.Cartesian3).z;this.view_.setRotation(f<0?g:-g);var p=Math.acos(Cesium.Cartesian3.dot(u,c));this.tilt_=isNaN(p)?0:p}else this.view_.setRotation(this.cam_.heading),this.tilt_=-this.cam_.pitch+Math.PI/2;this.viewUpdateInProgress_=!1}},i.checkCameraChange=function(e){var t=this.lastCameraViewMatrix_,i=this.cam_.viewMatrix;t&&Cesium.Matrix4.equalsEpsilon(t,i,1e-5)||(this.lastCameraViewMatrix_=i.clone(),!0!==e&&this.updateView())},i.calcDistanceForResolution=function(e,t){return function(e,t,i,r){var n=i.canvas,o=i.camera.frustum.fovy,s=r.getMetersPerUnit();return e*n.clientHeight*s*Math.cos(Math.abs(t))/2/Math.tan(o/2)}(e,t,this.scene_,this.view_.getProjection())},i.calcResolutionForDistance=function(e,t){return function(e,t,i,r){var n=i.canvas,o=i.camera.frustum.fovy,s=r.getMetersPerUnit();return 2*e*Math.tan(o/2)/s/Math.cos(Math.abs(t))/n.clientHeight}(e,t,this.scene_,this.view_.getProjection())},t}();var oe=M(602),se=M.n(oe);const ae=function(){function e(e,t){this.map=e,this.view=e.getView(),this.scene=t,this.olLayers=e.getLayerGroup().getLayers(),this.mapLayerGroup=e.getLayerGroup(),this.layerMap={},this.olLayerListenKeys={},this.olGroupListenKeys_={}}var t=e.prototype;return t.synchronize=function(){this.destroyAll(),this.addLayers_(this.mapLayerGroup)},t.orderLayers=function(){},t.addLayers_=function(e){for(var t=this,r=[{layer:e,parents:[]}],o=function(){var e=r.splice(0,1)[0],o=e.layer,s=n(o).toString();t.olLayerListenKeys[s]=[];var a=null;if(o instanceof se())t.listenForGroupChanges_(o),o!==t.mapLayerGroup&&(a=t.createSingleLayerCounterparts(e)),a||o.getLayers().forEach((function(i){if(i){var n={layer:i,parents:o===t.mapLayerGroup?[]:[e.layer].concat(e.parents)};r.push(n)}}));else if(!(a=t.createSingleLayerCounterparts(e))){var l=s,u=e;t.olLayerListenKeys[s].push(i(u.layer,"change",(function e(i){var r=t.createSingleLayerCounterparts(u);r&&(u.layer.un("change",e),t.addCesiumObjects_(r,l,u.layer),t.orderLayers())})))}a&&t.addCesiumObjects_(a,s,o)};r.length>0;)o();this.orderLayers()},t.addCesiumObjects_=function(e,t,r){var n=this;this.layerMap[t]=e,this.olLayerListenKeys[t].push(i(r,"change:zIndex",(function(){return n.orderLayers()}))),e.forEach((function(e){n.addCesiumObject(e)}))},t.removeAndDestroySingleLayer_=function(e){var t=this,i=n(e).toString(),r=this.layerMap[i];return r&&(r.forEach((function(e){t.removeSingleCesiumObject(e,!1),t.destroyCesiumObject(e)})),this.olLayerListenKeys[i].forEach(ee.unByKey),delete this.olLayerListenKeys[i]),delete this.layerMap[i],!!r},t.unlistenSingleGroup_=function(e){if(e!==this.mapLayerGroup){var t=n(e).toString();this.olGroupListenKeys_[t].forEach((function(e){(0,ee.unByKey)(e)})),delete this.olGroupListenKeys_[t],delete this.layerMap[t]}},t.removeLayer_=function(e){var t=this;e&&function(){for(var i=[e];i.length>0;){var r=i.splice(0,1)[0],n=t.removeAndDestroySingleLayer_(r);r instanceof se()&&(t.unlistenSingleGroup_(r),n||r.getLayers().forEach((function(e){i.push(e)})))}}()},t.listenForGroupChanges_=function(e){var t=n(e).toString(),i=[];this.olGroupListenKeys_[t]=i;var r=[],o=function(){var t=this,n=e.getLayers();n&&(r=[n.on("add",(function(e){t.addLayers_(e.element)})),n.on("remove",(function(e){t.removeLayer_(e.element)}))],i.push.apply(i,r))}.bind(this);o(),i.push(e.on("change:layers",(function(e){r.forEach((function(e){var t=i.indexOf(e);t>=0&&i.splice(t,1),(0,ee.unByKey)(e)})),o()})))},t.destroyAll=function(){var e;for(e in this.removeAllCesiumObjects(!0),this.olGroupListenKeys_){this.olGroupListenKeys_[e].forEach(ee.unByKey)}for(e in this.olLayerListenKeys)this.olLayerListenKeys[e].forEach(ee.unByKey);this.olGroupListenKeys_={},this.olLayerListenKeys={},this.layerMap={}},t.addCesiumObject=function(e){},t.destroyCesiumObject=function(e){},t.removeSingleCesiumObject=function(e,t){},t.removeAllCesiumObjects=function(e){},t.createSingleLayerCounterparts=function(e){},e}();function le(e,t){return(le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}const ue=function(e){var t,i;function r(t,i){var r;return(r=e.call(this,t,i)||this).cesiumLayers_=i.imageryLayers,r.ourLayers_=new Cesium.ImageryLayerCollection,r}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,le(t,i);var o=r.prototype;return o.addCesiumObject=function(e){this.cesiumLayers_.add(e),this.ourLayers_.add(e)},o.destroyCesiumObject=function(e){e.destroy()},o.removeSingleCesiumObject=function(e,t){this.cesiumLayers_.remove(e,t),this.ourLayers_.remove(e,!1)},o.removeAllCesiumObjects=function(e){for(var t=0;t<this.ourLayers_.length;++t)this.cesiumLayers_.remove(this.ourLayers_.get(t),e);this.ourLayers_.removeAll(!1)},o.convertLayerToCesiumImageries=function(e,t){var i=Q.tileLayerToImageryLayer(this.map,e,t);return i?[i]:null},o.createSingleLayerCounterparts=function(e){var t=this,i=e.layer,r=n(i).toString(),o=this.view.getProjection(),s=this.convertLayerToCesiumImageries(i,o);if(s){var a,l=[];if([e.layer].concat(e.parents).forEach((function(t){l.push(t.on(["change:opacity","change:visible"],(function(){for(var t=0;t<s.length;++t)Q.updateCesiumLayerProperties(e,s[t])})))})),i.getStyleFunction){var u=i.getStyleFunction();l.push(i.on("change",(function(){var e=i.getStyleFunction();if(u!==e){u=e;for(var r=0;r<s.length;++r){var n=s[r];n._imageryCache&&n.imageryProvider.cache_&&(n._imageryCache={},n.imageryProvider.cache_={},n.imageryProvider.styleFunction_=e)}t.scene.requestRender()}})))}for(var c=0;c<s.length;++c)Q.updateCesiumLayerProperties(e,s[c]);l.push(i.on("change:extent",(function(e){for(var r=0;r<s.length;++r)t.cesiumLayers_.remove(s[r],!0),t.ourLayers_.remove(s[r],!1);delete t.layerMap[n(i)],t.synchronize()}))),l.push(i.on("change",(function(e){for(var i=0;i<s.length;++i){var r=t.cesiumLayers_.indexOf(s[i]);r>=0&&(t.cesiumLayers_.remove(s[i],!1),t.cesiumLayers_.add(s[i],r))}}))),(a=this.olLayerListenKeys[r]).push.apply(a,l)}return Array.isArray(s)?s:null},o.orderLayers=function(){for(var e=this,t=[],i={},r=[this.mapLayerGroup];r.length>0;){var o=r.splice(0,1)[0];if(t.push(o),i[n(o)]=o.getZIndex()||0,o instanceof se()){var s=o.getLayers();s&&r.unshift.apply(r,s.getArray())}}!function(e,t){for(var i=e.length,r=Array(e.length),n=0;n<i;n++)r[n]={index:n,value:e[n]};r.sort((function(e,i){return t(e.value,i.value)||e.index-i.index}));for(var o=0;o<e.length;o++)e[o]=r[o].value}(t,(function(e,t){return i[n(e)]-i[n(t)]})),t.forEach((function(t){var i=n(t).toString(),r=e.layerMap[i];r&&r.forEach((function(t){e.raiseToTop(t)}))}))},o.raiseToTop=function(e){this.cesiumLayers_.raiseToTop(e)},r}(ae);M(42),M(455);var ce=M(347),he=M.n(ce),me=M(134),de=M.n(me),ge=M(477),fe=M.n(ge),pe=M(741),ve=M.n(pe),ye=M(196),Ce=M(740),_e=M(708),Se=M.n(_e);const be=function(){function e(e,t){var i=new Cesium.BillboardCollection({scene:t}),r=new Cesium.PrimitiveCollection;this.olListenKeys=[],this.rootCollection_=new Cesium.PrimitiveCollection,this.context={projection:e,billboards:i,featureToCesiumMap:{},primitives:r},this.rootCollection_.add(i),this.rootCollection_.add(r)}var t=e.prototype;return t.destroy=function(){this.olListenKeys.forEach(ee.unByKey),this.olListenKeys.length=0},t.getRootPrimitive=function(){return this.rootCollection_},e}();function we(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return Te(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Te(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Te(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}const Pe=function(){function e(e){this.scene=e,this.boundOnRemoveOrClearFeatureListener_=this.onRemoveOrClearFeature_.bind(this),this.defaultBillboardEyeOffset_=new Cesium.Cartesian3(0,0,10)}var t=e.prototype;return t.onRemoveOrClearFeature_=function(e){var t=e.target,i=s.obj(t).olcs_cancellers;if(i){var r=e.feature;if(r){var o=n(r),a=i[o];a&&(a(),delete i[o])}else{for(var l in i)i.hasOwnProperty(l)&&i[l]();s.obj(t).olcs_cancellers={}}}},t.setReferenceForPicking=function(e,t,i){i.olLayer=e,i.olFeature=t},t.createColoredPrimitive=function(e,t,i,r,n,o){var s={flat:!0,renderState:{depthTest:{enabled:!0}}};void 0!==o&&(s.renderState||(s.renderState={}),s.renderState.lineWidth=o);var a,l=function(e,t){var i=new Cesium.GeometryInstance({geometry:e});return!t||t instanceof Cesium.ImageMaterialProperty||(i.attributes={color:Cesium.ColorGeometryInstanceAttribute.fromColor(t)}),i}(r,n);if(this.getHeightReference(e,t,i)===Cesium.HeightReference.CLAMP_TO_GROUND){var u=l.geometry.constructor;if(u&&!u.createShadowVolume)return null;a=new Cesium.GroundPrimitive({geometryInstances:l})}else a=new Cesium.Primitive({geometryInstances:l});if(n instanceof Cesium.ImageMaterialProperty){var c=n.image.getValue().toDataURL();a.appearance=new Cesium.MaterialAppearance({flat:!0,renderState:{depthTest:{enabled:!0}},material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:c}}})})}else a.appearance=new Cesium.PerInstanceColorAppearance(s);return this.setReferenceForPicking(e,t,a),a},t.extractColorFromOlStyle=function(e,t){var i=e.getFill()?e.getFill().getColor():null,r=e.getStroke()?e.getStroke().getColor():null,n="black";return r&&t?n=r:i&&(n=i),Q.convertColorToCesium(n)},t.extractLineWidthFromOlStyle=function(e){var t=e.getStroke()?e.getStroke().getWidth():void 0;return void 0!==t?t:1},t.wrapFillAndOutlineGeometries=function(e,t,i,r,n,o){var s=this.extractColorFromOlStyle(o,!1),a=this.extractColorFromOlStyle(o,!0),l=new Cesium.PrimitiveCollection;if(o.getFill()){var u=this.createColoredPrimitive(e,t,i,r,s);l.add(u)}if(o.getStroke()&&n){var c=this.extractLineWidthFromOlStyle(o),h=this.createColoredPrimitive(e,t,i,n,a,c);h&&l.add(h)}return l},t.addTextStyle=function(e,t,i,r,n){var o;if(n instanceof Cesium.PrimitiveCollection?o=n:(o=new Cesium.PrimitiveCollection).add(n),!r.getText())return o;var s=r.getText(),a=this.olGeometry4326TextPartToCesium(e,t,i,s);return a&&o.add(a),o},t.csAddBillboard=function(e,t,i,r,n,o){t.eyeOffset||(t.eyeOffset=this.defaultBillboardEyeOffset_);var s=e.add(t);return this.setReferenceForPicking(i,r,s),s},t.olCircleGeometryToCesium=function(e,t,i,r,n){var s=this,a=(i=Q.olGeometryCloneTo4326(i,r)).getCenter(),l=3==a.length?a[2]:0,u=a.slice();u[0]+=i.getRadius(),a=Q.ol4326CoordinateToCesiumCartesian(a),u=Q.ol4326CoordinateToCesiumCartesian(u);var c,h,m=Cesium.Cartesian3.distance(a,u),d=new Cesium.CircleGeometry({center:a,radius:m,height:l});if(this.getHeightReference(e,t,i)===Cesium.HeightReference.CLAMP_TO_GROUND){var g=this.extractLineWidthFromOlStyle(n);if(g){var f=(0,ye.circular)(i.getCenter(),m),p=Q.ol4326CoordinateArrayToCsCartesians(f.getLinearRing(0).getCoordinates());if(o(this.scene))(c=new Cesium.GroundPolylinePrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.GroundPolylineGeometry({positions:p,width:g})}),appearance:new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,n,!0)}),classificationType:Cesium.ClassificationType.TERRAIN})).readyPromise.then((function(){s.setReferenceForPicking(e,t,c._primitive)}));else{var v=this.extractColorFromOlStyle(n,!0);c=this.createStackedGroundCorridors(e,t,g,v,p)}}}else h=new Cesium.CircleOutlineGeometry({center:a,radius:m,extrudedHeight:l,height:l});var y=this.wrapFillAndOutlineGeometries(e,t,i,d,h,n);return c&&y.add(c),this.addTextStyle(e,t,i,n,y)},t.createStackedGroundCorridors=function(e,t,i,r,n){Array.isArray(n[0])||(n=[n]),i=Math.max(3,i);for(var o=[],s=0,a=0,l=[1e3,4e3,16e3,64e3,254e3,1e6,1e7];a<l.length;a++){for(var u,c=l[a],h={width:i*=2.14,vertexFormat:Cesium.VertexFormat.POSITION_ONLY},m=we(n);!(u=m()).done;){var d=u.value;h.positions=d,o.push(new Cesium.GeometryInstance({geometry:new Cesium.CorridorGeometry(h),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(r),distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(s,c-1)}}))}s=c}return new Cesium.GroundPrimitive({geometryInstances:o})},t.olLineStringGeometryToCesium=function(e,t,i,r,n){var s=this;i=Q.olGeometryCloneTo4326(i,r);var a,l=Q.ol4326CoordinateArrayToCsCartesians(i.getCoordinates()),u=this.extractLineWidthFromOlStyle(n),c=this.getHeightReference(e,t,i);if(c!==Cesium.HeightReference.CLAMP_TO_GROUND||o(this.scene)){var h=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,n,!0)}),m={positions:l,width:u},d={appearance:h};if(c===Cesium.HeightReference.CLAMP_TO_GROUND){var g=new Cesium.GroundPolylineGeometry(m);d.geometryInstances=new Cesium.GeometryInstance({geometry:g}),(a=new Cesium.GroundPolylinePrimitive(d)).readyPromise.then((function(){s.setReferenceForPicking(e,t,a._primitive)}))}else{m.vertexFormat=h.vertexFormat;var f=new Cesium.PolylineGeometry(m);d.geometryInstances=new Cesium.GeometryInstance({geometry:f}),a=new Cesium.Primitive(d)}}else{var p=this.extractColorFromOlStyle(n,!0);a=this.createStackedGroundCorridors(e,t,u,p,l)}return this.setReferenceForPicking(e,t,a),this.addTextStyle(e,t,i,n,a)},t.olPolygonGeometryToCesium=function(e,t,i,r,n){var s=this;i=Q.olGeometryCloneTo4326(i,r);var a,l,u,c=this.getHeightReference(e,t,i);if(5==i.getCoordinates()[0].length&&"rectangle"===t.getGeometry().get("olcs.polygon_kind")){var h=i.getCoordinates()[0],m=(0,Ce.boundingExtent)(h),d=Cesium.Rectangle.fromDegrees(m[0],m[1],m[2],m[3]),g=0;if(3==h[0].length)for(var f=0;f<h.length;f++)g=Math.max(g,h[f][2]);a=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:d,height:g}),l=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:d,height:g})}else{for(var p=i.getLinearRings(),v={},y=v,C=0;C<p.length;++C){var _=p[C].getCoordinates(),S=Q.ol4326CoordinateArrayToCsCartesians(_);0==C?v.positions=S:(v.holes||(v.holes=[]),v.holes.push({positions:S}))}if(a=new Cesium.PolygonGeometry({polygonHierarchy:y,perPositionHeight:!0}),c===Cesium.HeightReference.CLAMP_TO_GROUND){var b=this.extractLineWidthFromOlStyle(n);if(b>0){var w=[v.positions];if(v.holes)for(var T=0;T<v.holes.length;++T)w.push(v.holes[T].positions);if(o(this.scene)){for(var P,L=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,n,!0)}),R=[],j=we(w);!(P=j()).done;){var E=P.value,x=new Cesium.GroundPolylineGeometry({positions:E,width:b});R.push(new Cesium.GeometryInstance({geometry:x}))}var O={appearance:L,geometryInstances:R};(u=new Cesium.GroundPolylinePrimitive(O)).readyPromise.then((function(){s.setReferenceForPicking(e,t,u._primitive)}))}else{var A=this.extractColorFromOlStyle(n,!0);u=this.createStackedGroundCorridors(e,t,b,A,w)}}}else l=new Cesium.PolygonOutlineGeometry({polygonHierarchy:v,perPositionHeight:!0})}var I=this.wrapFillAndOutlineGeometries(e,t,i,a,l,n);return u&&I.add(u),this.addTextStyle(e,t,i,n,I)},t.getHeightReference=function(e,t,i){var r=i.get("altitudeMode");void 0===r&&(r=t.get("altitudeMode")),void 0===r&&(r=e.get("altitudeMode"));var n=Cesium.HeightReference.NONE;return"clampToGround"===r?n=Cesium.HeightReference.CLAMP_TO_GROUND:"relativeToGround"===r&&(n=Cesium.HeightReference.RELATIVE_TO_GROUND),n},t.createBillboardFromImage=function(e,t,i,r,o,a,l,u){a instanceof ve()&&a.load();var c=a.getImage(1),h=function(){if(c&&(c instanceof HTMLCanvasElement||c instanceof Image||c instanceof HTMLImageElement)){var r,n=i.getCoordinates(),s=Q.ol4326CoordinateToCesiumCartesian(n),h=a.getOpacity();void 0!==h&&(r=new Cesium.Color(1,1,1,h));var m=a.getScale(),d=this.getHeightReference(e,t,i),g={image:c,color:r,scale:m,heightReference:d,position:s};if(Object.assign(g,t.get("cesiumOptions")),a instanceof ve()){var f=a.getAnchor();f&&(g.pixelOffset=new Cesium.Cartesian2((c.width/2-f[0])*m,(c.height/2-f[1])*m))}var p=this.csAddBillboard(l,g,e,t,i,o);u&&u(p)}}.bind(this);if(c instanceof Image&&!function(e){return""!=e.src&&0!=e.naturalHeight&&0!=e.naturalWidth&&e.complete}(c)){var m=!1,d=e.getSource();d.on(["removefeature","clear"],this.boundOnRemoveOrClearFeatureListener_);var g=s.obj(d).olcs_cancellers;g||(g=s.obj(d).olcs_cancellers={});var f=n(t);g[f]&&g[f](),g[f]=function(){m=!0};c.addEventListener("load",(function e(){c.removeEventListener("load",e),l.isDestroyed()||m||h()}))}else h()},t.olPointGeometryToCesium=function(e,t,i,r,n,o,s){i=Q.olGeometryCloneTo4326(i,r);var a=null,l=n.getImage();if(l){var u=i.get("olcs_model")||t.get("olcs_model");if(u){var c=u(),h=Object.assign({},{scene:this.scene},c.cesiumOptions),m=Cesium.Model.fromGltf(h);(a=new Cesium.PrimitiveCollection).add(m),c.debugModelMatrix&&a.add(new Cesium.DebugModelMatrixPrimitive({modelMatrix:c.debugModelMatrix}))}else this.createBillboardFromImage(e,t,i,r,n,l,o,s)}return n.getText()?this.addTextStyle(e,t,i,n,a||new Cesium.Primitive):a},t.olMultiGeometryToCesium=function(e,t,i,r,n,o,s){var a,l=this,u=function(i,o){var s=new Cesium.PrimitiveCollection;return i.forEach((function(i){s.add(o(e,t,i,r,n))})),s};switch(i.getType()){case"MultiPoint":if(a=(i=i).getPoints(),n.getText()){var c=new Cesium.PrimitiveCollection;return a.forEach((function(i){var a=l.olPointGeometryToCesium(e,t,i,r,n,o,s);a&&c.add(a)})),c}return a.forEach((function(i){l.olPointGeometryToCesium(e,t,i,r,n,o,s)})),null;case"MultiLineString":return u(a=(i=i).getLineStrings(),this.olLineStringGeometryToCesium.bind(this));case"MultiPolygon":return u(a=(i=i).getPolygons(),this.olPolygonGeometryToCesium.bind(this))}},t.olGeometry4326TextPartToCesium=function(e,t,i,r){var n=r.getText();if(!n)return null;var o=new Cesium.LabelCollection({scene:this.scene}),s=(0,Ce.getCenter)(i.getExtent());if(i instanceof Se()){var a=i.getFirstCoordinate();s[2]=3==a.length?a[2]:0}var l={};l.position=Q.ol4326CoordinateToCesiumCartesian(s),l.text=n,l.heightReference=this.getHeightReference(e,t,i);var u=r.getOffsetX(),c=r.getOffsetY();if(0!=u&&0!=c){var h=new Cesium.Cartesian2(u,c);l.pixelOffset=h}l.font=r.getFont()||"10px sans-serif";var m,d=void 0;switch(r.getFill()&&(l.fillColor=this.extractColorFromOlStyle(r,!1),d=Cesium.LabelStyle.FILL),r.getStroke()&&(l.outlineWidth=this.extractLineWidthFromOlStyle(r),l.outlineColor=this.extractColorFromOlStyle(r,!0),d=Cesium.LabelStyle.OUTLINE),r.getFill()&&r.getStroke()&&(d=Cesium.LabelStyle.FILL_AND_OUTLINE),l.style=d,r.getTextAlign()){case"left":m=Cesium.HorizontalOrigin.LEFT;break;case"right":m=Cesium.HorizontalOrigin.RIGHT;break;case"center":default:m=Cesium.HorizontalOrigin.CENTER}if(l.horizontalOrigin=m,r.getTextBaseline()){var g;switch(r.getTextBaseline()){case"top":g=Cesium.VerticalOrigin.TOP;break;case"middle":g=Cesium.VerticalOrigin.CENTER;break;case"bottom":g=Cesium.VerticalOrigin.BOTTOM;break;case"alphabetic":g=Cesium.VerticalOrigin.TOP;break;case"hanging":g=Cesium.VerticalOrigin.BOTTOM}l.verticalOrigin=g}var f=o.add(l);return this.setReferenceForPicking(e,t,f),o},t.olStyleToCesium=function(e,t,i){var r=t.getFill(),n=t.getStroke();if(i&&!n||!i&&!r)return null;var o=i?n.getColor():r.getColor();return o=Q.convertColorToCesium(o),i&&n.getLineDash()?Cesium.Material.fromType("Stripe",{horizontal:!1,repeat:500,evenColor:o,oddColor:new Cesium.Color(0,0,0,0)}):Cesium.Material.fromType("Color",{color:o})},t.computePlainStyle=function(e,t,i,r){var n=t.getStyleFunction(),o=null;return n&&(o=n(t,r)),!o&&i&&(o=i(t,r)),o?Array.isArray(o)?o:[o]:null},t.getGeometryFromFeature=function(e,t,i){if(i)return i;var r=e.get("olcs.3d_geometry");if(r&&r instanceof fe())return r;if(t){var n=t.getGeometryFunction()(e);if(n instanceof fe())return n}return e.getGeometry()},t.olFeatureToCesium=function(e,t,i,r,o){var s=this,a=this.getGeometryFromFeature(t,i,o);if(!a)return null;var l=r.projection,u=function(e){var i=r.featureToCesiumMap[n(t)];i instanceof Array?i.push(e):r.featureToCesiumMap[n(t)]=[e]};switch(a.getType()){case"GeometryCollection":var c=new Cesium.PrimitiveCollection;return a.getGeometries().forEach((function(n){if(n){var o=s.olFeatureToCesium(e,t,i,r,n);o&&c.add(o)}})),c;case"Point":a=a;var h=r.billboards,m=this.olPointGeometryToCesium(e,t,a,l,i,h,u);return m||null;case"Circle":return a=a,this.olCircleGeometryToCesium(e,t,a,l,i);case"LineString":return a=a,this.olLineStringGeometryToCesium(e,t,a,l,i);case"Polygon":return a=a,this.olPolygonGeometryToCesium(e,t,a,l,i);case"MultiPoint":case"MultiLineString":case"MultiPolygon":var d=this.olMultiGeometryToCesium(e,t,a,l,i,r.billboards,u);return d||null;case"LinearRing":throw new Error("LinearRing should only be part of polygon.");default:throw new Error("Ol geom type not handled : "+a.getType())}},t.olVectorLayerToCesium=function(e,t,i){var r=t.getProjection(),o=t.getResolution();if(void 0===o||!r)throw new Error("View not ready");var s=e.getSource();s instanceof he()&&(s=s.getSource());for(var a=s.getFeatures(),l=new be(r,this.scene),u=l.context,c=0;c<a.length;++c){var h=a[c];if(h){var m=e.getStyleFunction(),d=this.computePlainStyle(e,h,m,o);if(d&&d.length){for(var g=null,f=0;f<d.length;f++){var p=this.olFeatureToCesium(e,h,d[f],u);if(p)if(g){if(p)for(var v=0,y=void 0;y=p.get(v);)g.add(y),v++}else g=p}g&&(i[n(h)]=g,l.getRootPrimitive().add(g))}}}return l},t.convert=function(e,t,i,r){var n=t.getProjection(),o=t.getResolution();if(null==o||!n)return null;var s=e.getStyleFunction(),a=this.computePlainStyle(e,i,s,o);if(!a||!a.length)return null;r.projection=n;for(var l=null,u=0;u<a.length;u++){var c=this.olFeatureToCesium(e,i,a[u],r);if(l){if(c)for(var h=0,m=void 0;m=c.get(h);)l.add(m),h++}else l=c}return l},e}();function Le(e,t){return(Le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}const Re=function(e){var t,r;function o(t,i,r){var n;return(n=e.call(this,t,i)||this).converter=r||new Pe(i),n.csAllPrimitives_=new Cesium.PrimitiveCollection,i.primitives.add(n.csAllPrimitives_),n.csAllPrimitives_.destroyPrimitives=!1,n}r=e,(t=o).prototype=Object.create(r.prototype),t.prototype.constructor=t,Le(t,r);var s=o.prototype;return s.addCesiumObject=function(e){e.getRootPrimitive().counterpart=e,this.csAllPrimitives_.add(e.getRootPrimitive())},s.destroyCesiumObject=function(e){e.getRootPrimitive().destroy()},s.removeSingleCesiumObject=function(e,t){e.destroy(),this.csAllPrimitives_.destroyPrimitives=t,this.csAllPrimitives_.remove(e.getRootPrimitive()),this.csAllPrimitives_.destroyPrimitives=!1},s.removeAllCesiumObjects=function(e){if(this.csAllPrimitives_.destroyPrimitives=e,e)for(var t=0;t<this.csAllPrimitives_.length;++t)this.csAllPrimitives_.get(t).counterpart.destroy();this.csAllPrimitives_.removeAll(),this.csAllPrimitives_.destroyPrimitives=!1},s.updateLayerVisibility=function(e,t){var i=!0;[e.layer].concat(e.parents).forEach((function(e){var t=e.getVisible();void 0!==t?i&=t:i=!1})),t.show=i},s.createSingleLayerCounterparts=function(e){var t=this,r=e.layer;if(!(r instanceof de())||r instanceof H())return null;var o=r.getSource();if(o instanceof he()&&(o=o.getSource()),!o)return null;var s=this.view,a={},l=this.converter.olVectorLayerToCesium(r,s,a),u=l.getRootPrimitive(),c=l.olListenKeys;[e.layer].concat(e.parents).forEach((function(r){c.push(i(r,"change:visible",(function(){t.updateLayerVisibility(e,u)})))})),this.updateLayerVisibility(e,u);var h=function(e){var t=l.context,i=this.converter.convert(r,s,e,t);i&&(a[n(e)]=i,u.add(i))}.bind(this),m=function(e){var t=n(e),i=l.context,r=i.featureToCesiumMap[t];r&&(delete i.featureToCesiumMap[t],r.forEach((function(e){e instanceof Cesium.Billboard&&i.billboards.remove(e)})));var o=a[t];delete a[t],o&&u.remove(o)}.bind(this);return c.push(i(o,"addfeature",(function(e){h(e.feature)}))),c.push(i(o,"removefeature",(function(e){m(e.feature)}))),c.push(i(o,"changefeature",(function(e){var t=e.feature;m(t),h(t)}))),l?[l]:null},o}(ae);var je=M(932);function Ee(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return xe(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return xe(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}const Ae=function(t){var i,r;function n(e){var i,r=e.parent;(i=t.call(this,r.getOptions())||this).scenePostRenderListenerRemover_=null,i.scene_=e.scene,i.synchronizer_=e.synchronizer,i.parent_=r,i.positionWGS84_=void 0,i.observer_=new MutationObserver(i.handleElementChanged.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i))),i.attributeObserver_=[],i.listenerKeys_=[];var n=function(e){return i.setPropertyFromEvent_(e)};return i.listenerKeys_.push(i.parent_.on("change:position",n)),i.listenerKeys_.push(i.parent_.on("change:element",n)),i.listenerKeys_.push(i.parent_.on("change:offset",n)),i.listenerKeys_.push(i.parent_.on("change:position",n)),i.listenerKeys_.push(i.parent_.on("change:positioning",n)),i.setProperties(i.parent_.getProperties()),i.handleMapChanged(),i.handleElementChanged(),i}r=t,(i=n).prototype=Object.create(r.prototype),i.prototype.constructor=i,Oe(i,r);var o=n.prototype;return o.observeTarget_=function(e){if(this.observer_){this.observer_.disconnect(),this.observer_.observe(e,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),this.attributeObserver_.forEach((function(e){e.disconnect()})),this.attributeObserver_.length=0;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1===i.nodeType){var r=new MutationObserver(this.handleElementChanged.bind(this));r.observe(i,{attributes:!0,subtree:!0}),this.attributeObserver_.push(r)}}}},o.setPropertyFromEvent_=function(e){e.target&&e.key&&this.set(e.key,e.target.get(e.key))},o.getScene=function(){return this.scene_},o.handleMapChanged=function(){var e;this.scenePostRenderListenerRemover_&&(this.scenePostRenderListenerRemover_(),(e=this.element)&&e.parentNode&&e.parentNode.removeChild(e)),this.scenePostRenderListenerRemover_=null;var t=this.getScene();if(t){this.scenePostRenderListenerRemover_=t.postRender.addEventListener(this.updatePixelPosition.bind(this)),this.updatePixelPosition();var i=this.stopEvent?this.synchronizer_.getOverlayContainerStopEvent():this.synchronizer_.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element)}},o.handlePositionChanged=function(){var t=this.getPosition();if(t){var i=this.parent_.getMap().getView().getProjection();this.positionWGS84_=(0,e.transform)(t,i,"EPSG:4326")}else this.positionWGS84_=void 0;this.updatePixelPosition()},o.handleElementChanged=function(){function e(t,i){var r=t.cloneNode();"CANVAS"===t.nodeName&&r.getContext("2d").drawImage(t,0,0);i&&i.appendChild(r),t.nodeType!=Node.TEXT_NODE&&r.addEventListener("click",(function(e){t.dispatchEvent(new MouseEvent("click",e)),e.stopPropagation()}));for(var n=t.childNodes,o=0;o<n.length;o++)n[o]&&e(n[o],r);return r}!function(e){for(;e.lastChild;)e.removeChild(e.lastChild)}(this.element);var t=this.getElement();if(t&&t.parentNode&&t.parentNode.childNodes)for(var i,r=Ee(t.parentNode.childNodes);!(i=r()).done;){var n=e(i.value,null);this.element.appendChild(n)}t.parentNode&&this.observeTarget_(t.parentNode)},o.updatePixelPosition=function(){var e=this.positionWGS84_;if(this.scene_&&e){var t=0;if(2===e.length){var i=this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(e[0],e[1]));i&&this.scene_.globe.tilesLoaded&&(e[2]=i),i&&(t=i)}else t=e[2];var r=Cesium.Cartesian3.fromDegrees(e[0],e[1],t),n=this.scene_.camera,o=new Cesium.BoundingSphere(new Cesium.Cartesian3,6356752);if(new Cesium.Occluder(o,n.position).isPointVisible(r))if(1===n.frustum.computeCullingVolume(n.position,n.direction,n.up).computeVisibility(new Cesium.BoundingSphere(r))){this.setVisible(!0);var s=this.scene_.cartesianToCanvasCoordinates(r),a=[s.x,s.y],l=[this.scene_.canvas.width,this.scene_.canvas.height];this.updateRenderedPosition(a,l)}else this.setVisible(!1);else this.setVisible(!1)}else this.setVisible(!1)},o.destroy=function(){this.scenePostRenderListenerRemover_&&this.scenePostRenderListenerRemover_(),this.observer_&&this.observer_.disconnect(),(0,ee.unByKey)(this.listenerKeys_),this.listenerKeys_.splice(0),this.element.removeNode?this.element.removeNode(!0):this.element.remove(),this.element=null},n}(M.n(je)());const Ie=function(){function e(e,t){var i=this;this.map=e,this.overlays_=this.map.getOverlays(),this.scene=t,this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent";["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"].forEach((function(e){i.overlayContainerStopEvent_.addEventListener(e,(function(e){return e.stopPropagation()}))})),this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_),this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.scene.canvas.parentElement.appendChild(this.overlayContainer_),this.overlayMap_={}}var t=e.prototype;return t.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},t.getOverlayContainer=function(){return this.overlayContainer_},t.synchronize=function(){this.destroyAll(),this.addOverlays(),this.overlays_.on("add",this.addOverlayFromEvent_.bind(this)),this.overlays_.on("remove",this.removeOverlayFromEvent_.bind(this))},t.addOverlayFromEvent_=function(e){var t=e.element;this.addOverlay(t)},t.addOverlays=function(){var e=this;this.overlays_.forEach((function(t){e.addOverlay(t)}))},t.addOverlay=function(e){if(e){var t=new Ae({scene:this.scene,synchronizer:this,parent:e}),i=n(e).toString();this.overlayMap_[i]=t}},t.removeOverlayFromEvent_=function(e){var t=e.element;this.removeOverlay(t)},t.removeOverlay=function(e){var t=n(e).toString(),i=this.overlayMap_[t];i&&(i.destroy(),delete this.overlayMap_[t])},t.destroyAll=function(){var e=this;Object.keys(this.overlayMap_).forEach((function(t){e.overlayMap_[t].destroy(),delete e.overlayMap_[t]}))},e}();function Ge(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const Fe=function(){function t(i){this.autoRenderLoop_=null,this.map_=i.map,this.time_=i.time||function(){return Cesium.JulianDate.now()},this.to4326Transform_=(0,e.getTransform)(this.map_.getView().getProjection(),"EPSG:4326"),this.resolutionScale_=1,this.canvasClientWidth_=0,this.canvasClientHeight_=0,this.resolutionScaleChanged_=!0;var r="position:absolute;top:0;left:0;width:100%;height:100%;";this.container_=document.createElement("DIV");var n=document.createAttribute("style");n.value=r+"visibility:hidden;",this.container_.setAttributeNode(n);var o=i.target||this.map_.getViewport();if("string"==typeof o&&(o=document.getElementById(o)),o.appendChild(this.container_),this.isOverMap_=!i.target,this.isOverMap_&&i.stopOpenLayersEventsPropagation)for(var a=["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"],l=0,u=a.length;l<u;++l)this.container_.addEventListener(a[l],(function(e){return e.stopPropagation()}));this.canvas_=document.createElement("CANVAS");var c=document.createAttribute("style");c.value=r,this.canvas_.setAttributeNode(c),s.supportsImageRenderingPixelated()&&(this.canvas_.style.imageRendering=s.imageRenderingValue()),this.canvas_.oncontextmenu=function(){return!1},this.canvas_.onselectstart=function(){return!1},this.container_.appendChild(this.canvas_),this.enabled_=!1,this.pausedInteractions_=[],this.hiddenRootGroup_=null;var h=void 0!==i.sceneOptions?i.sceneOptions:{};h.canvas=this.canvas_,h.scene3DOnly=!0,this.scene_=new Cesium.Scene(h);var m=this.scene_.screenSpaceCameraController;m.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT}),m.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT}),m.enableLook=!1,this.scene_.camera.constrainedAxis=Cesium.Cartesian3.UNIT_Z,this.camera_=new ne(this.scene_,this.map_),this.globe_=new Cesium.Globe(Cesium.Ellipsoid.WGS84),this.globe_.baseColor=Cesium.Color.WHITE,this.scene_.globe=this.globe_,this.scene_.skyAtmosphere=new Cesium.SkyAtmosphere;var d=new Cesium.SingleTileImageryProvider({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",rectangle:Cesium.Rectangle.fromDegrees(0,0,1,1)});this.globe_.imageryLayers.addImageryProvider(d,0),this.dataSourceCollection_=new Cesium.DataSourceCollection,this.dataSourceDisplay_=new Cesium.DataSourceDisplay({scene:this.scene_,dataSourceCollection:this.dataSourceCollection_});var g=i.createSynchronizers?i.createSynchronizers(this.map_,this.scene_,this.dataSourceCollection_):[new ue(this.map_,this.scene_),new Re(this.map_,this.scene_),new Ie(this.map_,this.scene_)];this.handleResize_();for(var f=g.length-1;f>=0;--f)g[f].synchronize();this.lastFrameTime_=0,this.renderId_=void 0,this.targetFrameRate_=Number.POSITIVE_INFINITY,this.blockCesiumRendering_=!1,this.warmingUp_=!1,this.trackedFeature_=null,this.trackedEntity_=null,this.entityView_=null,this.needTrackedEntityUpdate_=!1,this.boundingSphereScratch_=new Cesium.BoundingSphere,(new Cesium.EventHelper).add(this.scene_.postRender,t.prototype.updateTrackedEntity_,this),Cesium.Camera.enableSuspendTerrainAdjustment=!1}var i,r,n,o=t.prototype;return o.render_=function(){void 0!==this.renderId_&&(cancelAnimationFrame(this.renderId_),this.renderId_=void 0),!this.enabled_&&!this.warmingUp_||this.blockCesiumRendering_||(this.renderId_=requestAnimationFrame(this.onAnimationFrame_.bind(this)))},o.onAnimationFrame_=function(e){this.renderId_=void 0;var t=1e3/this.targetFrameRate_;if(e-this.lastFrameTime_<t)this.render_();else{this.lastFrameTime_=e;var i=this.time_();if(this.scene_.initializeFrame(),this.handleResize_(),this.dataSourceDisplay_.update(i),this.entityView_){var r=this.trackedEntity_;this.dataSourceDisplay_.getBoundingSphere(r,!1,this.boundingSphereScratch_)===Cesium.BoundingSphereState.DONE&&(this.boundingSphereScratch_.radius=1,this.entityView_.update(i,this.boundingSphereScratch_))}this.scene_.render(i),this.camera_.checkCameraChange(),this.render_()}},o.updateTrackedEntity_=function(){if(this.needTrackedEntityUpdate_){var e=this.trackedEntity_,t=this.scene_,i=this.dataSourceDisplay_.getBoundingSphere(e,!1,this.boundingSphereScratch_);if(i!==Cesium.BoundingSphereState.PENDING){t.screenSpaceCameraController.enableTilt=!1;var r=i!==Cesium.BoundingSphereState.FAILED?this.boundingSphereScratch_:void 0;r&&(r.radius=1),this.entityView_=new Cesium.EntityView(e,t,t.mapProjection.ellipsoid),this.entityView_.update(this.time_(),r),this.needTrackedEntityUpdate_=!1}}},o.handleResize_=function(){var e=this.canvas_.clientWidth,t=this.canvas_.clientHeight;if(!(0===e|0===t)&&(e!==this.canvasClientWidth_||t!==this.canvasClientHeight_||this.resolutionScaleChanged_)){var i=this.resolutionScale_;s.supportsImageRenderingPixelated()||(i*=window.devicePixelRatio||1),this.resolutionScaleChanged_=!1,this.canvasClientWidth_=e,this.canvasClientHeight_=t,e*=i,t*=i,this.canvas_.width=e,this.canvas_.height=t,this.scene_.camera.frustum.aspectRatio=e/t}},o.getCamera=function(){return this.camera_},o.getOlMap=function(){return this.map_},o.getOlView=function(){return this.map_.getView()},o.getCesiumScene=function(){return this.scene_},o.getDataSources=function(){return this.dataSourceCollection_},o.getDataSourceDisplay=function(){return this.dataSourceDisplay_},o.getEnabled=function(){return this.enabled_},o.setEnabled=function(e){var t,i=this;if(this.enabled_!==e)if(this.enabled_=e,this.container_.style.visibility=this.enabled_?"visible":"hidden",this.enabled_){if(this.throwOnUnitializedMap_(),this.isOverMap_){(t=this.map_.getInteractions()).forEach((function(e,t,r){i.pausedInteractions_.push(e)})),t.clear(),this.map_.addInteraction=function(e){return i.pausedInteractions_.push(e)},this.map_.removeInteraction=function(e){return i.pausedInteractions_=i.pausedInteractions_.filter((function(t){return t!==e}))};var r=this.map_.getLayerGroup();r.getVisible()&&(this.hiddenRootGroup_=r,this.hiddenRootGroup_.setVisible(!1)),this.map_.getOverlayContainer().classList.add("olcs-hideoverlay")}this.camera_.readFromView(),this.render_()}else this.isOverMap_&&(t=this.map_.getInteractions(),this.pausedInteractions_.forEach((function(e){t.push(e)})),this.pausedInteractions_.length=0,this.map_.addInteraction=function(e){return i.map_.getInteractions().push(e)},this.map_.removeInteraction=function(e){return i.map_.getInteractions().remove(e)},this.map_.getOverlayContainer().classList.remove("olcs-hideoverlay"),this.hiddenRootGroup_&&(this.hiddenRootGroup_.setVisible(!0),this.hiddenRootGroup_=null)),this.camera_.updateView()},o.warmUp=function(e,t){var i=this;if(!this.enabled_){this.throwOnUnitializedMap_(),this.camera_.readFromView();var r=this.globe_.ellipsoid,n=this.scene_.camera,o=r.cartesianToCartographic(n.position);o.height<e&&(o.height=e,n.position=r.cartographicToCartesian(o)),this.warmingUp_=!0,this.render_(),setTimeout((function(){i.warmingUp_=!1}),t)}},o.setBlockCesiumRendering=function(e){this.blockCesiumRendering_!==e&&(this.blockCesiumRendering_=e,this.render_())},o.enableAutoRenderLoop=function(){this.autoRenderLoop_||(this.autoRenderLoop_=new J(this))},o.getAutoRenderLoop=function(){return this.autoRenderLoop_},o.setResolutionScale=function(e){(e=Math.max(0,e))!==this.resolutionScale_&&(this.resolutionScale_=Math.max(0,e),this.resolutionScaleChanged_=!0,this.autoRenderLoop_&&this.autoRenderLoop_.restartRenderLoop())},o.setTargetFrameRate=function(e){this.targetFrameRate_!==e&&(this.targetFrameRate_=e,this.render_())},o.throwOnUnitializedMap_=function(){var e=this.map_.getView(),t=e.getCenter();if(!e.isDef()||isNaN(t[0])||isNaN(t[1]))throw new Error("The OpenLayers map is not properly initialized: "+t+" / "+e.getResolution())},i=t,(r=[{key:"trackedFeature",get:function(){return this.trackedFeature_},set:function(e){if(this.trackedFeature_!==e){var t=this.scene_;if(!e||!e.getGeometry())return this.needTrackedEntityUpdate_=!1,t.screenSpaceCameraController.enableTilt=!0,this.trackedEntity_&&this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_),this.trackedEntity_=null,this.trackedFeature_=null,this.entityView_=null,void t.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);this.trackedFeature_=e,this.needTrackedEntityUpdate_=!0;var i=this.to4326Transform_,r={position:new Cesium.CallbackProperty((function(t,r){return n=e.getGeometry().getCoordinates(),o=i(n,void 0,n.length),Q.ol4326CoordinateToCesiumCartesian(o);var n,o}),!1),point:{pixelSize:1,color:Cesium.Color.TRANSPARENT}};this.trackedEntity_=this.dataSourceDisplay_.defaultDataSource.entities.add(r)}}}])&&Ge(i.prototype,r),n&&Ge(i,n),t}();var Me=function(){function e(e){this.promise,this.url_=e}return e.prototype.load=function(){var e=this;return this.promise||(this.promise=new Promise((function(t,i){var r=document.createElement("script");r.onload=function(){return t()},r.onerror=function(){return i()},document.head.appendChild(r),r.src=e.url_}))),this.promise},e}();function Ve(e,t,i){return(Ve=ke()?Reflect.construct:function(e,t,i){var r=[null];r.push.apply(r,t);var n=new(Function.bind.apply(e,r));return i&&qe(n,i.prototype),n}).apply(null,arguments)}function ke(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function qe(e,t){return(qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}const Ne=function(e){var t,i;function r(t,i){var r,n=void 0===i?{}:i,o=n.map,s=n.cameraExtentInRadians,a=n.cesiumIonDefaultAccessToken;return(r=e.call(this)||this).cesiumUrl_=t,r.map=o,r.cameraExtentInRadians=s||null,r.boundingSphere_,r.blockLimiter_=!1,r.promise_,r.cesiumIonDefaultAccessToken_=a,r.ol3d,r.cesiumInitialTilt_=re(50),r.fogDensity=1e-4,r.fogSSEFactor=25,r.minimumZoomDistance=2,r.maximumZoomDistance=1e7,r.limitCameraToBoundingSphereRatio=function(e){return e>3e3?9:3},r}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,qe(t,i);var n=r.prototype;return n.load=function(){var e=this;if(!this.promise_){var t=new Me(this.cesiumUrl_);this.promise_=t.load().then((function(){return e.onCesiumLoaded()}))}return this.promise_},n.onCesiumLoaded=function(){if(this.cameraExtentInRadians){var e=Ve(Cesium.Rectangle,this.cameraExtentInRadians);Cesium.Camera.DEFAULT_VIEW_RECTANGLE=e,this.boundingSphere_=Cesium.BoundingSphere.fromRectangle3D(e,Cesium.Ellipsoid.WGS84,300)}this.cesiumIonDefaultAccessToken_&&(Cesium.Ion.defaultAccessToken=this.cesiumIonDefaultAccessToken_),this.ol3d=this.instantiateOLCesium();var t=this.ol3d.getCesiumScene();return this.configureForUsability(t),this.configureForPerformance(t),this.dispatchEvent("load"),this.ol3d},n.instantiateOLCesium=function(){var e=new Fe({map:this.map}),t=e.getCesiumScene(),i=Cesium.createWorldTerrain();return t.terrainProvider=i,e},n.configureForPerformance=function(e){var t=e.fog;t.enabled=!0,t.density=this.fogDensity,t.screenSpaceErrorFactor=this.fogSSEFactor},n.configureForUsability=function(e){var t=e.screenSpaceCameraController;t.minimumZoomDistance=this.minimumZoomDistance,t.maximumZoomDistance=this.maximumZoomDistance,e.globe.depthTestAgainstTerrain=!0,e.globe.baseColor=Cesium.Color.WHITE,e.backgroundColor=Cesium.Color.WHITE,this.boundingSphere_&&e.postRender.addEventListener(this.limitCameraToBoundingSphere.bind(this),e),this.ol3d.enableAutoRenderLoop()},n.limitCameraToBoundingSphere=function(){var e=this;if(this.boundingSphere_&&!this.blockLimiter_){var t=this.ol3d.getCesiumScene().camera,i=t.position,r=Cesium.Cartographic.fromCartesian(i),n=this.limitCameraToBoundingSphereRatio(r.height);if(Cesium.Cartesian3.distance(this.boundingSphere_.center,i)>this.boundingSphere_.radius*n){if(!0===t.flying)return;this.blockLimiter_=!0;var o=function(){return e.blockLimiter_=!1};t.flyToBoundingSphere(this.boundingSphere_,{complete:o,cancel:o})}}},n.toggle3d=function(){var e=this;return this.load().then((function(t){var i=t.getEnabled(),r=t.getCesiumScene();return i?Q.resetToNorthZenith(e.map,r).then((function(){t.setEnabled(!1),e.dispatchEvent("toggle")})):(t.setEnabled(!0),e.dispatchEvent("toggle"),Q.rotateAroundBottomCenter(r,e.cesiumInitialTilt_))}))},n.set3dWithView=function(e,t,i,r,n){var o=this;return this.load().then((function(s){var a=s.getEnabled(),l=s.getCesiumScene().camera,u=Cesium.Cartesian3.fromDegrees(e,t,i),c={heading:Cesium.Math.toRadians(r),pitch:Cesium.Math.toRadians(n),roll:0};a||(s.setEnabled(!0),o.dispatchEvent("toggle")),l.setView({destination:u,orientation:c})}))},n.is3dEnabled=function(){return!!this.ol3d&&this.ol3d.getEnabled()},n.getHeading=function(){return this.map&&this.map.getView().getRotation()||0},n.getTiltOnGlobe=function(){var e=this.ol3d.getCesiumScene();return-Q.computeSignedTiltAngleOnGlobe(e)},n.setHeading=function(e){var t=this.ol3d.getCesiumScene(),i=Q.pickBottomPoint(t);i&&Q.setHeadingUsingBottomCenter(t,e,i)},n.getOl3d=function(){return this.ol3d},n.getOlView=function(){return this.map.getView()},n.getCesiumViewMatrix=function(){return this.ol3d.getCesiumScene().camera.viewMatrix},n.getCesiumScene=function(){return this.ol3d.getCesiumScene()},n.flyToRectangle=function(e,t){var i=this;void 0===t&&(t=0);var r=this.getCesiumScene().camera,n=r.getRectangleCameraCoordinates(e),o=Cesium.Cartesian3.magnitude(n)+t;return Cesium.Cartesian3.normalize(n,n),Cesium.Cartesian3.multiplyByScalar(n,o,n),new Promise((function(e,t){i.cameraExtentInRadians?r.flyTo({destination:n,complete:function(){return e()},cancel:function(){return t()},endTransform:Cesium.Matrix4.IDENTITY}):t()}))},n.getCameraExtentRectangle=function(){if(this.cameraExtentInRadians)return Ve(Cesium.Rectangle,this.cameraExtentInRadians)},r}(te()),De=Fe;var Be=window.olcs={};Be.OLCesium=Fe,Be.AbstractSynchronizer=ae,Be.RasterSynchronizer=ue,Be.VectorSynchronizer=Re,Be.core=Q,Be.core.OLImageryProvider=R,Be.core.VectorLayerCounterpart=be,Be.contrib={},Be.contrib.LazyLoader=Me,Be.contrib.Manager=Ne})(),V})()}));
//# sourceMappingURL=olcesium.umd.js.map